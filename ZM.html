<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#10b981">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>≈Ωralomƒõr</title>

  <link rel="manifest" href="data:application/json,%7B%22name%22%3A%22%C5%BDralom%C4%9Br%22%2C%22short_name%22%3A%22%C5%BDralom%C4%9Br%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22fullscreen%22%2C%22background_color%22%3A%22%23111827%22%2C%22theme_color%22%3A%22%2310b981%22%2C%22orientation%22%3A%22portrait-primary%22%7D">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    body { 
      font-family: system-ui, -apple-system, sans-serif; 
      background-image: url('https://i.postimg.cc/RVj59f4Z/Screenshot-20250906-085711-Gallery.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    .overlay { background: rgba(0,0,0,0.68); }
    .glass { background: rgba(24,24,27,0.88) !important; backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.12); }
    .big-btn { background: linear-gradient(135deg, #10b981, #34d399); }
    .camera-frame { background: rgba(255,255,255,0.05); border: 3px solid rgba(255,255,255,0.3); backdrop-filter: blur(10px); }
  </style>
</head>
<body class="text-white min-h-screen pb-20 relative">

  <div class="overlay absolute inset-0 z-[-1]"></div>

  <div class="max-w-xl mx-auto p-4 relative z-10">

    <div class="flex justify-center items-center gap-3 mb-8">
      <span class="text-6xl">ü¶à</span>
      <h1 class="text-5xl font-bold text-emerald-400 drop-shadow-2xl">≈Ωralomƒõr</h1>
    </div>

    <div class="glass rounded-3xl p-6 text-center mb-8">
      <p class="text-emerald-300 text-sm">Dnes jsi snƒõdl</p>
      <div id="dailyTotal" class="text-6xl font-bold text-emerald-400">0 kcal</div>
    </div>

    <button onclick="startNewMeal()" 
            class="big-btn w-full py-7 rounded-3xl text-2xl font-bold shadow-2xl active:scale-95 transition flex items-center justify-center gap-3 mb-10">
      <i class="fas fa-plus text-3xl"></i> P≈òIDAT J√çDLO
    </button>

    <div class="mb-10">
      <h2 class="text-lg font-bold mb-4 px-1">Rychl√© ≈°ablony</h2>
      <div id="templatesList" class="flex gap-3 overflow-x-auto pb-4 snap-x"></div>
    </div>

    <div>
      <h2 class="text-lg font-bold mb-4 px-1">Posledn√≠ j√≠dla</h2>
      <div id="quickHistory" class="space-y-3"></div>
    </div>
  </div>

  <div class="fixed bottom-0 left-0 right-0 glass border-t border-white/10">
    <div class="max-w-xl mx-auto grid grid-cols-4 text-center text-xs">
      <button onclick="switchScreen(0)" class="py-3 flex flex-col items-center text-emerald-400">
        <i class="fas fa-home text-xl"></i><span class="mt-1">Dnes</span>
      </button>
      <button onclick="switchScreen(1)" class="py-3 flex flex-col items-center">
        <i class="fas fa-star text-xl"></i><span class="mt-1">≈†ablony</span>
      </button>
      <button onclick="switchScreen(2)" class="py-3 flex flex-col items-center">
        <i class="fas fa-history text-xl"></i><span class="mt-1">Historie</span>
      </button>
      <button onclick="toggleSettings()" class="py-3 flex flex-col items-center">
        <i class="fas fa-cog text-xl"></i><span class="mt-1">Nastaven√≠</span>
      </button>
    </div>
  </div>

  <div id="addModal" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center z-[100]">
    <div class="glass w-full max-w-md mx-4 rounded-3xl p-6">
      <h2 class="text-2xl font-bold mb-4">P≈ôidat j√≠dlo</h2>

      <div class="camera-frame rounded-3xl overflow-hidden mb-4">
        <div id="preview" class="aspect-square bg-black/20 flex items-center justify-center relative">
          <input type="file" id="fileInput" accept="image/*" capture="environment" class="hidden">
          <button onclick="takePhoto()" class="camera-btn w-20 h-20 rounded-full flex items-center justify-center text-4xl shadow-2xl active:scale-95">üì∏</button>
          <img id="photo" class="hidden w-full h-full object-cover">
        </div>
      </div>

      <textarea id="manualText" rows="3" placeholder="nap≈ô. hovƒõz√≠ maso 200g, brambory 300g..." 
                class="w-full glass p-4 rounded-2xl text-white resize-y mb-4"></textarea>

      <div class="flex gap-3">
        <button onclick="analyze()" id="analyzeBtn" class="flex-1 glass py-4 rounded-2xl font-medium disabled:opacity-50" disabled>‚ú® Analyzovat AI</button>
        <button onclick="closeAddModal()" class="flex-1 bg-zinc-700 py-4 rounded-2xl font-medium">Zav≈ô√≠t</button>
      </div>
    </div>
  </div>

  <div id="confirmModal" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center z-[110]">
    <div class="glass w-full max-w-md mx-4 rounded-3xl p-6">
      <h2 class="text-2xl font-bold mb-4">Potvrzen√≠ od AI</h2>
      <div id="aiSuggestion" class="glass p-5 rounded-2xl mb-6 text-sm leading-relaxed whitespace-pre-line"></div>
      
      <div class="flex gap-3">
        <button onclick="confirmMeal()" class="flex-1 bg-emerald-500 py-5 rounded-2xl font-medium">‚úÖ Ano, p≈ôidat</button>
        <button onclick="editMeal()" class="flex-1 glass py-5 rounded-2xl font-medium">Upravit</button>
        <button onclick="closeConfirmModal()" class="flex-1 bg-zinc-700 py-5 rounded-2xl font-medium">Zru≈°it</button>
      </div>
    </div>
  </div>

  <div id="settingsModal" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center z-[100]">
    <div class="glass w-full max-w-md mx-4 rounded-3xl p-6">
      <h2 class="text-2xl font-bold mb-4">Nastaven√≠</h2>
      
      <div class="mb-6">
        <label class="block text-sm text-emerald-400 mb-2">Tv√© jm√©no</label>
        <input id="userName" type="text" placeholder="" class="w-full glass p-4 rounded-2xl text-sm">
      </div>
      <div class="mb-6">
        <label class="block text-sm text-emerald-400 mb-2">Gemini API kl√≠ƒç</label>
        <input id="apiKey" type="text" placeholder="" class="w-full glass p-4 rounded-2xl text-sm">
      </div>

      <button onclick="showReadme()" class="w-full glass py-4 rounded-2xl mb-4 text-lg font-medium">üìñ Podrobn√Ω n√°vod</button>
      <button onclick="forceFullscreen()" class="w-full glass py-4 rounded-2xl mb-4 text-lg font-medium">üî≤ Cel√° obrazovka</button>

      <div class="flex gap-3">
        <button onclick="saveSettings()" class="flex-1 bg-emerald-500 py-4 rounded-2xl font-medium">Ulo≈æit</button>
        <button onclick="closeSettingsModal()" class="flex-1 bg-zinc-700 py-4 rounded-2xl font-medium">Zav≈ô√≠t</button>
      </div>
    </div>
  </div>

  <script>
    let currentBase64 = null;
    let currentResult = null;
    let currentSuggestionText = "";

    function startNewMeal() {
      document.getElementById('addModal').classList.remove('hidden');
      document.getElementById('photo').classList.add('hidden');
      currentBase64 = null;
      document.getElementById('manualText').value = '';
      document.getElementById('analyzeBtn').disabled = true;
    }

    function closeAddModal() {
      document.getElementById('addModal').classList.add('hidden');
    }

    function takePhoto() {
      document.getElementById('fileInput').click();
    }

    document.getElementById('fileInput').addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        currentBase64 = ev.target.result.split(',')[1];
        document.getElementById('photo').src = ev.target.result;
        document.getElementById('photo').classList.remove('hidden');
        document.getElementById('analyzeBtn').disabled = false;
      };
      reader.readAsDataURL(file);
    });

    async function analyze() {
      const apiKey = localStorage.getItem('apiKey');
      if (!apiKey) {
        closeAddModal();
        document.getElementById('settingsModal').classList.remove('hidden');
        return;
      }

      const text = document.getElementById('manualText').value.trim();
      if (!currentBase64 && !text) return alert('Napi≈° popis nebo vyfo≈• j√≠dlo');

      const btn = document.getElementById('analyzeBtn');
      btn.innerHTML = '‚è≥ Analyzuji...';
      btn.disabled = true;

      let parts = [{ text: `Jsi p≈ôesn√Ω nutriƒçn√≠ specialista. Vra≈• POUZE platn√Ω JSON (≈æ√°dn√Ω jin√Ω text!):

{
  "items": [{"name": "n√°zev", "portion": "mno≈æstv√≠", "calories": 123, "protein": 5, "carbs": 30, "fat": 8}],
  "totalCalories": 450,
  "summary": "kr√°tk√© ƒçesk√© hodnocen√≠"
}` }];

      if (text) parts.push({ text: "Popis od u≈æivatele: " + text });
      if (currentBase64) parts.push({ inlineData: { mimeType: "image/jpeg", data: currentBase64 } });

      try {
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ contents: [{ parts }], generationConfig: { response_mime_type: "application/json" } })
        });

        const data = await res.json();
        const raw = data.candidates[0].content.parts[0].text;
        currentResult = JSON.parse(raw);
        if (!currentResult.totalCalories) currentResult.totalCalories = currentResult.items.reduce((a,b)=>a+(b.calories||0),0);

        currentSuggestionText = currentResult.summary || 
          `Odhaduji: ${currentResult.totalCalories} kcal\n` + 
          currentResult.items.map(i => `‚Ä¢ ${i.name} (${i.portion})`).join('\n');

        closeAddModal();
        showConfirmation();
      } catch (err) {
        alert('Chyba AI: ' + err.message);
      }

      btn.innerHTML = '‚ú® Analyzovat AI';
      btn.disabled = false;
    }

    function showConfirmation() {
      document.getElementById('aiSuggestion').innerHTML = `<p class="text-emerald-300">AI navrhuje:</p><p class="mt-3 whitespace-pre-line">${currentSuggestionText}</p>`;
      document.getElementById('confirmModal').classList.remove('hidden');
    }

    function confirmMeal() {
      const today = new Date().toISOString().split('T')[0];
      const time = new Date().toLocaleTimeString('cs-CZ', {hour:'2-digit', minute:'2-digit'});

      let history = JSON.parse(localStorage.getItem('mealHistory') || '[]');
      history.unshift({
        id: Date.now(),
        date: today,
        time: time,
        userName: localStorage.getItem('userName') || 'Nezn√°m√Ω',
        total: currentResult.totalCalories,
        items: currentResult.items,
        summary: currentResult.summary || ''
      });
      localStorage.setItem('mealHistory', JSON.stringify(history));

      alert('‚úÖ J√≠dlo √∫spƒõ≈°nƒõ p≈ôid√°no!');
      closeConfirmModal();
      renderDailyTotal();
    }

    function editMeal() {
      closeConfirmModal();
      startNewMeal();
    }

    function closeConfirmModal() {
      document.getElementById('confirmModal').classList.add('hidden');
    }

    function renderDailyTotal() {
      let history = JSON.parse(localStorage.getItem('mealHistory') || '[]');
      const today = new Date().toISOString().split('T')[0];
      const total = history.filter(m => m.date === today).reduce((sum, m) => sum + m.total, 0);
      document.getElementById('dailyTotal').textContent = total + ' kcal';
    }

    function saveSettings() {
      const name = document.getElementById('userName').value.trim();
      const key = document.getElementById('apiKey').value.trim();
      if (name && key) {
        localStorage.setItem('userName', name);
        localStorage.setItem('apiKey', key);
        alert('‚úÖ Ulo≈æeno!');
        closeSettingsModal();
      } else {
        alert('Vypl≈à pros√≠m jm√©no i API kl√≠ƒç');
      }
    }

    function toggleSettings() {
      document.getElementById('settingsModal').classList.remove('hidden');
      document.getElementById('userName').value = '';
      document.getElementById('apiKey').value = '';
    }

    function closeSettingsModal() {
      document.getElementById('settingsModal').classList.add('hidden');
    }

    function showReadme() {
      alert(`≈Ωralomƒõr v2.17 ‚Äì Jak pou≈æ√≠vat

1. Nastav jm√©no a API kl√≠ƒç v nastaven√≠
2. Klikni na velk√© tlaƒç√≠tko ‚ÄûP≈òIDAT J√çDLO‚Äú
3. Vyfo≈• j√≠dlo nebo napi≈° popis (nebo oboj√≠)
4. AI ti navrhne v√Ωsledek a zept√° se na potvrzen√≠
5. M≈Ø≈æe≈° potvrdit, upravit nebo zru≈°it

Data se ukl√°daj√≠ lok√°lnƒõ v prohl√≠≈æeƒçi.

U≈æij si to! ü¶à`);
    }

    function forceFullscreen() {
      document.documentElement.requestFullscreen().catch(() => {});
    }

    window.onload = () => {
      renderDailyTotal();
      setTimeout(forceFullscreen, 800);
    };
  </script>
</body>
</html>